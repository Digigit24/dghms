# Generated by Django 5.2.8 on 2025-12-23 08:25

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('appointments', '0001_initial'),
        ('contenttypes', '0002_remove_content_type_name'),
        ('doctors', '0001_initial'),
        ('patients', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='ClinicalNoteTemplate',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('name', models.CharField(help_text='Template name (e.g., Initial Consultation Form)', max_length=200)),
                ('code', models.CharField(help_text='Unique template code', max_length=50)),
                ('description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('display_order', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Clinical Note Template',
                'verbose_name_plural': 'Clinical Note Templates',
                'db_table': 'clinical_note_templates',
                'ordering': ['display_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ClinicalNoteTemplateField',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('field_name', models.CharField(help_text='Internal field name (use lowercase, no spaces)', max_length=100)),
                ('field_label', models.CharField(help_text='Display label for the field', max_length=200)),
                ('field_type', models.CharField(choices=[('text', 'Text (Short)'), ('textarea', 'Text Area (Long)'), ('number', 'Number'), ('decimal', 'Decimal'), ('boolean', 'Boolean (Yes/No)'), ('date', 'Date'), ('datetime', 'Date & Time'), ('time', 'Time'), ('select', 'Single Select'), ('multiselect', 'Multiple Select'), ('radio', 'Radio Buttons'), ('checkbox', 'Checkboxes'), ('image', 'Image Upload'), ('file', 'File Upload'), ('json', 'JSON Data')], max_length=20)),
                ('help_text', models.CharField(blank=True, help_text='Help text to display below the field', max_length=500)),
                ('placeholder', models.CharField(blank=True, help_text='Placeholder text for input fields', max_length=200)),
                ('default_value', models.TextField(blank=True, help_text='Default value for the field')),
                ('is_required', models.BooleanField(default=False, help_text='Is this field mandatory?')),
                ('min_value', models.DecimalField(blank=True, decimal_places=2, help_text='Minimum value (for number fields)', max_digits=10, null=True)),
                ('max_value', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum value (for number fields)', max_digits=10, null=True)),
                ('min_length', models.IntegerField(blank=True, help_text='Minimum length (for text fields)', null=True)),
                ('max_length', models.IntegerField(blank=True, help_text='Maximum length (for text fields)', null=True)),
                ('display_order', models.IntegerField(default=0, help_text='Order in which to display this field')),
                ('column_width', models.IntegerField(choices=[(1, '1/12'), (2, '2/12'), (3, '3/12'), (4, '4/12'), (5, '5/12'), (6, '6/12'), (7, '7/12'), (8, '8/12'), (9, '9/12'), (10, '10/12'), (11, '11/12'), (12, '12/12')], default=12, help_text='Bootstrap column width (1-12)')),
                ('show_condition', models.JSONField(blank=True, default=dict, help_text='Conditions to show this field based on other fields')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fields', to='opd.clinicalnotetemplate')),
            ],
            options={
                'verbose_name': 'Clinical Note Template Field',
                'verbose_name_plural': 'Clinical Note Template Fields',
                'db_table': 'clinical_note_template_fields',
                'ordering': ['template', 'display_order', 'id'],
            },
        ),
        migrations.CreateModel(
            name='ClinicalNoteTemplateFieldOption',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('option_value', models.CharField(help_text='Internal value', max_length=100)),
                ('option_label', models.CharField(help_text='Display label', max_length=200)),
                ('display_order', models.IntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional data for the option')),
                ('field', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='options', to='opd.clinicalnotetemplatefield')),
            ],
            options={
                'verbose_name': 'Template Field Option',
                'verbose_name_plural': 'Template Field Options',
                'db_table': 'clinical_note_template_field_options',
                'ordering': ['field', 'display_order', 'option_label'],
            },
        ),
        migrations.CreateModel(
            name='ClinicalNoteTemplateGroup',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('name', models.CharField(help_text='Group name (e.g., General Examination)', max_length=200)),
                ('description', models.TextField(blank=True)),
                ('display_order', models.IntegerField(default=0, help_text='Order in which to display this group')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Clinical Note Template Group',
                'verbose_name_plural': 'Clinical Note Template Groups',
                'db_table': 'clinical_note_template_groups',
                'ordering': ['display_order', 'name'],
                'indexes': [models.Index(fields=['tenant_id'], name='clinical_no_tenant__6428d8_idx'), models.Index(fields=['tenant_id', 'is_active'], name='clinical_no_tenant__7a66be_idx')],
                'unique_together': {('tenant_id', 'name')},
            },
        ),
        migrations.AddField(
            model_name='clinicalnotetemplate',
            name='group',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='templates', to='opd.clinicalnotetemplategroup'),
        ),
        migrations.CreateModel(
            name='ClinicalNoteTemplateResponse',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('object_id', models.PositiveIntegerField(help_text='ID of the encounter record')),
                ('response_sequence', models.IntegerField(default=1, help_text='Sequence number for multiple responses (1st, 2nd, 3rd fill of same template on same visit)')),
                ('original_assigned_doctor_id', models.UUIDField(blank=True, db_index=True, help_text='User ID of originally assigned doctor (tracks who was first assigned)', null=True)),
                ('doctor_switched_reason', models.TextField(blank=True, help_text='Reason for doctor change (absence, handover, specialty consultation, etc.)')),
                ('response_date', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('completed', 'Completed'), ('reviewed', 'Reviewed'), ('archived', 'Archived')], default='draft', max_length=20)),
                ('is_reviewed', models.BooleanField(default=False, help_text='Has this response been reviewed/approved by supervising doctor')),
                ('canvas_data', models.FileField(blank=True, help_text='Canvas image if doctor used stylus instead of structured input', null=True, upload_to='clinical_notes/canvas/%Y/%m/')),
                ('response_summary', models.JSONField(blank=True, default=dict, help_text='Cached summary of all responses')),
                ('filled_by_id', models.UUIDField(blank=True, help_text='User ID who filled the template', null=True)),
                ('reviewed_by_id', models.UUIDField(blank=True, help_text='User ID who reviewed the template', null=True)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('content_type', models.ForeignKey(help_text='Type of encounter (OPD Visit or IPD Admission)', on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype')),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='responses', to='opd.clinicalnotetemplate')),
            ],
            options={
                'verbose_name': 'Clinical Note Template Response',
                'verbose_name_plural': 'Clinical Note Template Responses',
                'db_table': 'clinical_note_template_responses',
                'ordering': ['-response_date'],
            },
        ),
        migrations.CreateModel(
            name='ClinicalNoteTemplateFieldResponse',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('value_text', models.TextField(blank=True)),
                ('value_number', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('value_boolean', models.BooleanField(blank=True, null=True)),
                ('value_date', models.DateField(blank=True, null=True)),
                ('value_datetime', models.DateTimeField(blank=True, null=True)),
                ('value_time', models.TimeField(blank=True, null=True)),
                ('value_json', models.JSONField(blank=True, default=dict)),
                ('value_file', models.FileField(blank=True, null=True, upload_to='clinical_notes/responses/%Y/%m/')),
                ('full_canvas_json', models.JSONField(blank=True, default=dict, help_text='Full Excalidraw JSON data for the canvas.', null=True)),
                ('canvas_thumbnail', models.ImageField(blank=True, help_text='Auto-generated thumbnail of the canvas.', null=True, upload_to='canvas_thumbnails/%Y/%m/')),
                ('canvas_version_history', models.JSONField(blank=True, default=list, help_text='History of previous canvas JSON states.', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('field', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='responses', to='opd.clinicalnotetemplatefield')),
                ('selected_options', models.ManyToManyField(blank=True, related_name='field_responses', to='opd.clinicalnotetemplatefieldoption')),
                ('response', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='field_responses', to='opd.clinicalnotetemplateresponse')),
            ],
            options={
                'verbose_name': 'Template Field Response',
                'verbose_name_plural': 'Template Field Responses',
                'db_table': 'clinical_note_template_field_responses',
                'ordering': ['response', 'field__display_order'],
            },
        ),
        migrations.CreateModel(
            name='ClinicalNoteResponseTemplate',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant identifier for multi-tenancy')),
                ('name', models.CharField(help_text="User-defined template name (e.g., 'Standard Follow-up', 'Initial Diabetes Consultation')", max_length=200)),
                ('description', models.TextField(blank=True, help_text="What this response template is for (e.g., 'Standard pattern for diabetes follow-ups')")),
                ('template_field_values', models.JSONField(default=dict, help_text='Stores cloned field responses for quick reuse. Format: {field_name: {label, type, value}}')),
                ('is_active', models.BooleanField(default=True, help_text='Can be archived/deactivated')),
                ('usage_count', models.IntegerField(default=0, help_text='Number of times this template has been used')),
                ('created_by_id', models.UUIDField(db_index=True, help_text='User ID of doctor who created this reusable template')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('source_response', models.ForeignKey(blank=True, help_text='Original response this template was created from', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='derived_templates', to='opd.clinicalnotetemplateresponse')),
            ],
            options={
                'verbose_name': 'Clinical Note Response Template',
                'verbose_name_plural': 'Clinical Note Response Templates',
                'db_table': 'clinical_note_response_templates',
                'ordering': ['-usage_count', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='OPDBill',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('bill_number', models.CharField(help_text='Unique bill identifier (e.g., OPD-BILL/20231223/001)', max_length=50, unique=True)),
                ('bill_date', models.DateTimeField(auto_now_add=True)),
                ('opd_type', models.CharField(choices=[('consultation', 'Consultation'), ('follow_up', 'Follow-up'), ('emergency', 'Emergency')], default='consultation', max_length=20)),
                ('opd_subtype', models.CharField(blank=True, default='NA', help_text='Additional classification if needed', max_length=50)),
                ('charge_type', models.CharField(choices=[('first_visit', 'First Visit'), ('revisit', 'Revisit'), ('emergency', 'Emergency')], default='first_visit', max_length=20)),
                ('diagnosis', models.TextField(blank=True)),
                ('remarks', models.TextField(blank=True)),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('discount_percent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00')), django.core.validators.MaxValueValidator(Decimal('100.00'))])),
                ('discount_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('payable_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('payment_mode', models.CharField(choices=[('cash', 'Cash'), ('card', 'Card'), ('upi', 'UPI'), ('bank', 'Bank Transfer'), ('multiple', 'Multiple Modes')], default='cash', max_length=20)),
                ('payment_details', models.JSONField(blank=True, default=dict, help_text='Store multiple payment details')),
                ('received_amount', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('balance_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('payment_status', models.CharField(choices=[('unpaid', 'Unpaid'), ('partial', 'Partially Paid'), ('paid', 'Paid')], default='unpaid', max_length=20)),
                ('billed_by_id', models.UUIDField(blank=True, help_text='User who created this bill', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('doctor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='opd_bills', to='doctors.doctorprofile')),
            ],
            options={
                'verbose_name': 'OPD Bill',
                'verbose_name_plural': 'OPD Bills',
                'db_table': 'opd_bills',
                'ordering': ['-bill_date'],
            },
        ),
        migrations.CreateModel(
            name='OPDBillItem',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('item_name', models.CharField(help_text='Description of the item/service', max_length=200)),
                ('source', models.CharField(choices=[('Consultation', 'Consultation'), ('Pharmacy', 'Pharmacy'), ('Lab', 'Laboratory'), ('Radiology', 'Radiology'), ('Procedure', 'Procedure'), ('Package', 'Package'), ('Therapy', 'Therapy'), ('Other', 'Other')], default='Other', help_text='Source/category of the charge', max_length=20)),
                ('quantity', models.IntegerField(default=1, help_text='Quantity (e.g., units for medicine, sessions for procedures)', validators=[django.core.validators.MinValueValidator(1)])),
                ('system_calculated_price', models.DecimalField(decimal_places=2, help_text='System-calculated price from master data', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('unit_price', models.DecimalField(decimal_places=2, help_text='Actual unit price (can be manually overridden)', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('total_price', models.DecimalField(decimal_places=2, help_text='Total price (quantity × unit_price)', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('is_price_overridden', models.BooleanField(default=False, help_text='Flag indicating if price was manually changed from system default')),
                ('origin_object_id', models.PositiveIntegerField(blank=True, help_text='ID of the source order', null=True)),
                ('notes', models.TextField(blank=True, help_text='Additional notes about this item')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('bill', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='opd.opdbill')),
                ('origin_content_type', models.ForeignKey(blank=True, help_text='Type of source order (DiagnosticOrder, MedicineOrder, etc.)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to='contenttypes.contenttype')),
            ],
            options={
                'verbose_name': 'OPD Bill Item',
                'verbose_name_plural': 'OPD Bill Items',
                'db_table': 'opd_bill_items',
                'ordering': ['bill', 'source', 'id'],
            },
        ),
        migrations.CreateModel(
            name='ProcedureMaster',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('name', models.CharField(max_length=200)),
                ('code', models.CharField(help_text='Unique procedure code', max_length=50, unique=True)),
                ('category', models.CharField(choices=[('laboratory', 'Laboratory'), ('radiology', 'Radiology'), ('cardiology', 'Cardiology'), ('pathology', 'Pathology'), ('ultrasound', 'Ultrasound'), ('ct_scan', 'CT Scan'), ('mri', 'MRI'), ('ecg', 'ECG'), ('xray', 'X-Ray'), ('other', 'Other')], max_length=50)),
                ('description', models.TextField(blank=True)),
                ('default_charge', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Procedure Master',
                'verbose_name_plural': 'Procedure Masters',
                'db_table': 'procedure_masters',
                'ordering': ['category', 'name'],
                'indexes': [models.Index(fields=['tenant_id'], name='procedure_m_tenant__35f3f8_idx'), models.Index(fields=['tenant_id', 'category'], name='procedure_m_tenant__e84f71_idx'), models.Index(fields=['tenant_id', 'is_active'], name='procedure_m_tenant__3b23a3_idx'), models.Index(fields=['code'], name='proc_master_code_idx'), models.Index(fields=['category'], name='proc_master_category_idx'), models.Index(fields=['is_active'], name='proc_master_active_idx')],
            },
        ),
        migrations.CreateModel(
            name='ProcedurePackage',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('name', models.CharField(max_length=200)),
                ('code', models.CharField(help_text='Unique package code', max_length=50, unique=True)),
                ('total_charge', models.DecimalField(decimal_places=2, help_text='Sum of individual procedure charges', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('discounted_charge', models.DecimalField(decimal_places=2, help_text='Package discounted price', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('procedures', models.ManyToManyField(related_name='packages', to='opd.proceduremaster')),
            ],
            options={
                'verbose_name': 'Procedure Package',
                'verbose_name_plural': 'Procedure Packages',
                'db_table': 'procedure_packages',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Visit',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('visit_number', models.CharField(help_text='Unique visit identifier (e.g., OPD/20231223/001)', max_length=50, unique=True)),
                ('created_by_id', models.UUIDField(blank=True, help_text='User who created the visit', null=True)),
                ('visit_date', models.DateField(auto_now_add=True)),
                ('visit_type', models.CharField(choices=[('new', 'New Visit'), ('follow_up', 'Follow-up'), ('emergency', 'Emergency')], default='new', max_length=20)),
                ('entry_time', models.DateTimeField(auto_now_add=True)),
                ('is_follow_up', models.BooleanField(default=False)),
                ('status', models.CharField(choices=[('waiting', 'Waiting'), ('called', 'Called'), ('in_consultation', 'In Consultation'), ('completed', 'Completed'), ('cancelled', 'Cancelled'), ('no_show', 'No Show')], default='waiting', max_length=20)),
                ('queue_position', models.IntegerField(blank=True, help_text='Position in waiting queue', null=True)),
                ('consultation_start_time', models.DateTimeField(blank=True, null=True)),
                ('consultation_end_time', models.DateTimeField(blank=True, null=True)),
                ('payment_status', models.CharField(choices=[('unpaid', 'Unpaid'), ('partial', 'Partially Paid'), ('paid', 'Paid')], default='unpaid', max_length=20)),
                ('total_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('paid_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('balance_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('appointment', models.ForeignKey(blank=True, help_text='For scheduled visits', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='opd_visit', to='appointments.appointment')),
                ('doctor', models.ForeignKey(blank=True, help_text='Assigned when patient is called', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='opd_visits', to='doctors.doctorprofile')),
                ('patient', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='opd_visits', to='patients.patientprofile')),
                ('referred_by', models.ForeignKey(blank=True, help_text='Referring doctor if applicable', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referred_visits', to='doctors.doctorprofile')),
            ],
            options={
                'verbose_name': 'OPD Visit',
                'verbose_name_plural': 'OPD Visits',
                'db_table': 'opd_visits',
                'ordering': ['-visit_date', '-entry_time'],
            },
        ),
        migrations.AddField(
            model_name='opdbill',
            name='visit',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='opd_bills', to='opd.visit'),
        ),
        migrations.CreateModel(
            name='ClinicalNote',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('ehr_number', models.CharField(blank=True, help_text='Electronic Health Record ID', max_length=50)),
                ('note_date', models.DateTimeField(auto_now_add=True)),
                ('present_complaints', models.TextField(blank=True, help_text="Patient's presenting complaints")),
                ('observation', models.TextField(blank=True, help_text="Doctor's observations")),
                ('diagnosis', models.TextField(blank=True, help_text='Clinical diagnosis')),
                ('investigation', models.TextField(blank=True, help_text='Investigations ordered')),
                ('treatment_plan', models.TextField(blank=True, help_text='Recommended treatment')),
                ('medicines_prescribed', models.JSONField(blank=True, default=list, help_text='List of prescribed medicines')),
                ('doctor_advice', models.TextField(blank=True, help_text="Doctor's advice to patient")),
                ('suggested_surgery_name', models.CharField(blank=True, help_text='Name of suggested surgery if any', max_length=200)),
                ('suggested_surgery_reason', models.TextField(blank=True, help_text='Reason for suggesting surgery')),
                ('next_followup_date', models.DateField(blank=True, help_text='Next follow-up appointment date', null=True)),
                ('created_by_id', models.UUIDField(blank=True, help_text='User who created the note', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('referred_doctor', models.ForeignKey(blank=True, help_text='Doctor to whom patient is referred', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='received_referrals', to='doctors.doctorprofile')),
                ('visit', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='clinical_note', to='opd.visit')),
            ],
            options={
                'verbose_name': 'Clinical Note',
                'verbose_name_plural': 'Clinical Notes',
                'db_table': 'clinical_notes',
                'ordering': ['-note_date'],
            },
        ),
        migrations.CreateModel(
            name='VisitAttachment',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('file', models.FileField(help_text='Upload medical documents', upload_to='opd/attachments/%Y/%m/')),
                ('file_name', models.CharField(max_length=255)),
                ('file_type', models.CharField(choices=[('xray', 'X-Ray'), ('report', 'Lab Report'), ('prescription', 'Prescription'), ('scan', 'Scan'), ('document', 'Document'), ('other', 'Other')], default='other', max_length=20)),
                ('description', models.TextField(blank=True, help_text='Description of the attachment')),
                ('uploaded_by_id', models.UUIDField(blank=True, help_text='User who uploaded this attachment', null=True)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('visit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='opd.visit')),
            ],
            options={
                'verbose_name': 'Visit Attachment',
                'verbose_name_plural': 'Visit Attachments',
                'db_table': 'visit_attachments',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='VisitFinding',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('tenant_id', models.UUIDField(db_index=True, help_text='Tenant this record belongs to')),
                ('finding_date', models.DateTimeField(auto_now_add=True)),
                ('finding_type', models.CharField(choices=[('examination', 'General Examination'), ('systemic', 'Systemic Examination')], default='examination', max_length=20)),
                ('temperature', models.DecimalField(blank=True, decimal_places=1, help_text='Temperature in °F', max_digits=4, null=True, validators=[django.core.validators.MinValueValidator(Decimal('90.0')), django.core.validators.MaxValueValidator(Decimal('110.0'))])),
                ('pulse', models.IntegerField(blank=True, help_text='Pulse rate per minute', null=True, validators=[django.core.validators.MinValueValidator(30), django.core.validators.MaxValueValidator(300)])),
                ('bp_systolic', models.IntegerField(blank=True, help_text='Systolic blood pressure', null=True, validators=[django.core.validators.MinValueValidator(50), django.core.validators.MaxValueValidator(300)])),
                ('bp_diastolic', models.IntegerField(blank=True, help_text='Diastolic blood pressure', null=True, validators=[django.core.validators.MinValueValidator(30), django.core.validators.MaxValueValidator(200)])),
                ('weight', models.DecimalField(blank=True, decimal_places=2, help_text='Weight in kg', max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.5')), django.core.validators.MaxValueValidator(Decimal('500.0'))])),
                ('height', models.DecimalField(blank=True, decimal_places=2, help_text='Height in cm', max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(Decimal('30.0')), django.core.validators.MaxValueValidator(Decimal('300.0'))])),
                ('bmi', models.DecimalField(blank=True, decimal_places=2, editable=False, help_text='Body Mass Index (auto-calculated)', max_digits=5, null=True)),
                ('spo2', models.IntegerField(blank=True, help_text='Oxygen saturation percentage', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('respiratory_rate', models.IntegerField(blank=True, help_text='Breaths per minute', null=True, validators=[django.core.validators.MinValueValidator(5), django.core.validators.MaxValueValidator(60)])),
                ('tongue', models.CharField(blank=True, help_text='Tongue examination findings', max_length=200)),
                ('throat', models.CharField(blank=True, help_text='Throat examination findings', max_length=200)),
                ('cns', models.CharField(blank=True, help_text='Central Nervous System findings', max_length=200)),
                ('rs', models.CharField(blank=True, help_text='Respiratory System findings', max_length=200)),
                ('cvs', models.CharField(blank=True, help_text='Cardiovascular System findings', max_length=200)),
                ('pa', models.CharField(blank=True, help_text='Per Abdomen findings', max_length=200)),
                ('recorded_by_id', models.UUIDField(blank=True, help_text='User who recorded these findings', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('visit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='findings', to='opd.visit')),
            ],
            options={
                'verbose_name': 'Visit Finding',
                'verbose_name_plural': 'Visit Findings',
                'db_table': 'visit_findings',
                'ordering': ['-finding_date'],
            },
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplatefield',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__dff161_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplatefield',
            index=models.Index(fields=['template', 'display_order'], name='clinical_no_templat_0ea822_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='clinicalnotetemplatefield',
            unique_together={('template', 'field_name')},
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplatefieldoption',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__39001f_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplatefieldoption',
            index=models.Index(fields=['field', 'display_order'], name='clinical_no_field_i_e6e0b8_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='clinicalnotetemplatefieldoption',
            unique_together={('field', 'option_value')},
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplate',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__a720e0_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplate',
            index=models.Index(fields=['tenant_id', 'is_active'], name='clinical_no_tenant__f40201_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplate',
            index=models.Index(fields=['code'], name='clinical_template_code_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='clinicalnotetemplate',
            unique_together={('tenant_id', 'code')},
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__8e7b4a_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['content_type', 'object_id'], name='clinical_no_content_bdb42b_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['template'], name='clinical_no_templat_329423_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['status'], name='clinical_no_status_7c5b22_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['-response_date'], name='clinical_no_respons_d88082_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['content_type', 'object_id', 'template', 'response_sequence'], name='clinical_no_content_fc411c_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['original_assigned_doctor_id'], name='clinical_no_origina_024f03_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplateresponse',
            index=models.Index(fields=['is_reviewed'], name='clinical_no_is_revi_f5692b_idx'),
        ),
        migrations.AddConstraint(
            model_name='clinicalnotetemplateresponse',
            constraint=models.UniqueConstraint(fields=('content_type', 'object_id', 'template', 'response_sequence'), name='unique_response_per_encounter_template'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplatefieldresponse',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__8849f2_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnotetemplatefieldresponse',
            index=models.Index(fields=['response'], name='clinical_no_respons_0ae2f4_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='clinicalnotetemplatefieldresponse',
            unique_together={('response', 'field')},
        ),
        migrations.AddIndex(
            model_name='clinicalnoteresponsetemplate',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__e6d601_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnoteresponsetemplate',
            index=models.Index(fields=['tenant_id', 'is_active'], name='clinical_no_tenant__05a27a_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnoteresponsetemplate',
            index=models.Index(fields=['created_by_id'], name='clinical_no_created_2413c8_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnoteresponsetemplate',
            index=models.Index(fields=['-usage_count'], name='clinical_no_usage_c_b6e6ee_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='clinicalnoteresponsetemplate',
            unique_together={('tenant_id', 'name', 'created_by_id')},
        ),
        migrations.AddIndex(
            model_name='opdbillitem',
            index=models.Index(fields=['tenant_id'], name='opd_bill_it_tenant__199569_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbillitem',
            index=models.Index(fields=['bill', 'source'], name='opd_bill_it_bill_id_cd28c1_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbillitem',
            index=models.Index(fields=['origin_content_type', 'origin_object_id'], name='opd_bill_it_origin__44074e_idx'),
        ),
        migrations.AddIndex(
            model_name='procedurepackage',
            index=models.Index(fields=['tenant_id'], name='procedure_p_tenant__e51d66_idx'),
        ),
        migrations.AddIndex(
            model_name='procedurepackage',
            index=models.Index(fields=['tenant_id', 'is_active'], name='procedure_p_tenant__549ea1_idx'),
        ),
        migrations.AddIndex(
            model_name='procedurepackage',
            index=models.Index(fields=['code'], name='proc_package_code_idx'),
        ),
        migrations.AddIndex(
            model_name='procedurepackage',
            index=models.Index(fields=['is_active'], name='proc_package_active_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['tenant_id'], name='opd_visits_tenant__5bdf40_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['tenant_id', 'visit_date'], name='opd_visits_tenant__663e99_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['tenant_id', 'status'], name='opd_visits_tenant__f7c259_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['visit_number'], name='visit_number_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['patient', 'visit_date'], name='visit_patient_date_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['doctor', 'visit_date'], name='visit_doctor_date_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['status', 'visit_date'], name='visit_status_date_idx'),
        ),
        migrations.AddIndex(
            model_name='visit',
            index=models.Index(fields=['payment_status'], name='visit_payment_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['tenant_id'], name='opd_bills_tenant__846053_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['tenant_id', 'bill_date'], name='opd_bills_tenant__600835_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['tenant_id', 'payment_status'], name='opd_bills_tenant__1f89ff_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['bill_number'], name='opd_bill_number_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['visit'], name='opd_bill_visit_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['doctor', 'bill_date'], name='opd_bill_doctor_date_idx'),
        ),
        migrations.AddIndex(
            model_name='opdbill',
            index=models.Index(fields=['payment_status'], name='opd_bill_payment_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnote',
            index=models.Index(fields=['tenant_id'], name='clinical_no_tenant__5cac57_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnote',
            index=models.Index(fields=['tenant_id', 'visit'], name='clinical_no_tenant__00271c_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnote',
            index=models.Index(fields=['visit'], name='clinical_note_visit_idx'),
        ),
        migrations.AddIndex(
            model_name='clinicalnote',
            index=models.Index(fields=['ehr_number'], name='clinical_note_ehr_idx'),
        ),
        migrations.AddIndex(
            model_name='visitattachment',
            index=models.Index(fields=['tenant_id'], name='visit_attac_tenant__ee690a_idx'),
        ),
        migrations.AddIndex(
            model_name='visitattachment',
            index=models.Index(fields=['tenant_id', 'visit'], name='visit_attac_tenant__dff207_idx'),
        ),
        migrations.AddIndex(
            model_name='visitattachment',
            index=models.Index(fields=['visit'], name='attachment_visit_idx'),
        ),
        migrations.AddIndex(
            model_name='visitattachment',
            index=models.Index(fields=['file_type'], name='attachment_type_idx'),
        ),
        migrations.AddIndex(
            model_name='visitfinding',
            index=models.Index(fields=['tenant_id'], name='visit_findi_tenant__695aed_idx'),
        ),
        migrations.AddIndex(
            model_name='visitfinding',
            index=models.Index(fields=['tenant_id', 'visit'], name='visit_findi_tenant__2307cd_idx'),
        ),
        migrations.AddIndex(
            model_name='visitfinding',
            index=models.Index(fields=['visit', '-finding_date'], name='finding_visit_date_idx'),
        ),
    ]
